<div class="fixed inset-0 bg-black z-[100] flex flex-col">
  <header class="bg-zinc-900/80 p-4 flex items-center justify-between flex-wrap gap-4">
    <div class="flex items-center gap-4">
      <button (click)="goBack()" class="text-white hover:text-red-500 transition-colors text-2xl">
        <i class="fas fa-arrow-left"></i>
      </button>
      <h1 class="text-xl md:text-2xl font-bold text-white truncate">
        {{ details()?.title || details()?.name || 'Loading...' }}
      </h1>
    </div>
    
    <div class="flex items-center gap-4 flex-wrap">
      @if (itemType() === 'tv' && details()) {
        <div class="flex items-center gap-4">
          <div>
            <label for="season" class="text-zinc-400 mr-2">Season:</label>
            <select id="season" (change)="onSeasonChange($event)" class="bg-zinc-800 text-white rounded p-2 border border-zinc-700 focus:outline-none focus:ring-2 focus:ring-red-500">
              @for (season of validSeasons; track season.id) {
                <option [value]="season.season_number" [selected]="season.season_number === selectedSeason()">
                  {{ season.name }}
                </option>
              }
            </select>
          </div>
          @if (seasonDetails()) {
            <div>
              <label for="episode" class="text-zinc-400 mr-2">Episode:</label>
              <select id="episode" (change)="onEpisodeChange($event)" class="bg-zinc-800 text-white rounded p-2 border border-zinc-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                @for (episode of seasonDetails()?.episodes; track episode.id) {
                  <option [value]="episode.episode_number" [selected]="episode.episode_number === selectedEpisode()">
                    E{{ episode.episode_number }} - {{ episode.name }}
                  </option>
                }
              </select>
            </div>
          }
        </div>
      }

      <div class="border-l border-zinc-700 pl-4 flex gap-2">
        <button (click)="selectTab('player')" 
                [class]="'px-4 py-2 rounded-md font-semibold transition-colors ' + (activeTab() === 'player' ? 'bg-red-600 text-white' : 'bg-zinc-700 hover:bg-zinc-600')">
            <i class="fas fa-play-circle mr-2"></i>Embed Player
        </button>
        <button (click)="selectTab('streams')"
                [class]="'px-4 py-2 rounded-md font-semibold transition-colors ' + (activeTab() === 'streams' ? 'bg-red-600 text-white' : 'bg-zinc-700 hover:bg-zinc-600')">
            <i class="fas fa-film mr-2"></i>Streams
        </button>
      </div>
    </div>
  </header>

  <main class="flex-1 bg-black flex flex-col items-center justify-center">
    @if (activeTab() === 'player') {
      @if (embedUrl()) {
        <iframe [src]="embedUrl() | safeUrl" class="w-full h-full border-0" allowfullscreen allow="autoplay; fullscreen"></iframe>
      } @else {
        <div class="text-zinc-500 text-2xl">
          <i class="fas fa-spinner fa-spin mr-2"></i> Loading Player...
        </div>
      }
    } @else if (activeTab() === 'streams') {
      <div class="w-full h-full overflow-y-auto p-4 md:p-8">
          <h2 class="text-2xl font-bold mb-4 text-white">Available Streams</h2>
          @if(isLoadingStreams()) {
            <div class="text-white text-lg flex items-center gap-3">
              <i class="fas fa-spinner fa-spin"></i>
              <span>Searching for streams...</span>
            </div>
          } @else if (streams().length > 0) {
            <div class="space-y-3">
                @for(stream of streams(); track $index) {
                    <div class="bg-zinc-900 p-4 rounded-lg flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 animate-fade-in">
                        <div class="flex-1">
                            <p class="font-bold text-lg text-white">{{ stream.source }}</p>
                            <div class="flex items-center gap-4 text-zinc-400 text-sm mt-1">
                                <span class="flex items-center gap-1.5 px-2 py-1 bg-zinc-800 rounded-full text-xs">
                                  <i [class]="'fas ' + (stream.provider === 'Torrent' ? 'fa-magnet' : 'fa-server')"></i>
                                  {{ stream.provider }}
                                </span>
                                <span class="font-semibold text-green-400">{{ stream.quality }}</span>
                                <span><i class="fas fa-file-archive mr-1"></i> {{ stream.size }}</span>
                                <span><i class="fas fa-users mr-1"></i> {{ stream.peers }} peers</span>
                            </div>
                        </div>
                        <button (click)="playStream(stream)" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-md transition-transform duration-200 transform hover:scale-105 w-full sm:w-auto">
                            <i class="fas fa-play mr-2"></i> Stream
                        </button>
                    </div>
                }
            </div>
          } @else {
            <p class="text-zinc-400">No streams found for this title.</p>
          }
          <p class="text-zinc-500 mt-6 text-center text-sm">
            For educational purposes only. This feature simulates finding streams from various sources.
          </p>
      </div>
    }
  </main>
</div>
